<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>OpenStack Topology Graph</title>
    <link rel="stylesheet" href="./assets/css/site.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.14.1/js-yaml.min.js"></script>
    <link rel="icon" href="./assets/img/favicon.ico" type="image/x-icon">
</head>

<body>
    <div class="container" id="interface1">
        <div class="buttons">
            <button id="locked" class="button">Lock Nodes</button>
            <button id="subnet" class="button">Show Subnets</button>
            <button id="ips" class="button">Show IPs</button>
            <button id="showInfo" class="button">Show Params</button>
            <button id="hideLegend" class="button">Hide Legend</button>
            <button id="tooltips" class="button">Tooltips +</button>
            <button id="darkMode" class="button">Dark Mode</button>
        </div>
        <div class="file-input-container">
            <input type="file" id="file-input" class="file-input" style="display:none;">
            <label for="file-input" class="file-input-label">Select File</label>
        </div>
        <div class="right-column">
            <div class="text-input">
                <textarea id="text-input" class="text-input" spellcheck="false"></textarea>
            </div>
        </div>
        <iframe id="console_host_iframe" class="iframe" style="display: none;"></iframe>
        <a id="console_host_link" url="#" onclick="toggleNewWindow()">
            <button id="console_host_button" class="console-host">Toggle Range</button>
        </a>
    </div>

    <button id="generator_button" class="generator" onclick="toggleInterface()">YAML Generator</button>

    <div class="generation" id="interface2">
        <div class="right-column">
            <div class="text-input">
                <textarea id="text-input" class="text-input" spellcheck="false"></textarea>
            </div>
        </div>
    </div>

    <script type="module" src="./main.js"></script>
    <script>
        const button1 = document.getElementById('locked');
        const button2 = document.getElementById('subnet');
        const button3 = document.getElementById('ips');
        const button4 = document.getElementById('showInfo');
        const button5 = document.getElementById('hideLegend');
        const button6 = document.getElementById('tooltips');
        const button7 = document.getElementById('darkMode');

        let locked = false;
        let subnet = false;
        let ips = false;
        let showInfo = false;
        let hideLegend = false;
        let tooltips = false;
        let darkMode = false;
        let isOpen = false;
        let generator = false;

        var consoleHost = document.getElementById('console_host_button');
        var width = window.innerWidth;
        var height = window.innerHeight;

        var iframe = document.getElementById("console_host_iframe");
        iframe.contentEditable = "true";
        iframe.sandbox = "allow-scripts allow-forms allow-pointer-lock allow-popups allow-same-origin";
        iframe.allow = "autoplay; fullscreen; accelerometer; camera; encrypted-media; geolocation; gyroscope; magnetometer; microphone; midi; payment";

        var generator_button = document.getElementById('generator_button');
        var interface1 = document.getElementById("interface1");
        var interface2 = document.getElementById("interface2");

        function updateButtons() {
            button1.classList.toggle('on', locked);
            button2.classList.toggle('on', subnet);
            button3.classList.toggle('on', ips);
            button4.classList.toggle('on', showInfo);
            button5.classList.toggle('on', hideLegend);
            button6.classList.toggle('on', tooltips);
            button7.classList.toggle('on', darkMode);

            if (darkMode) {
                document.body.style.backgroundColor = '#222222';
            } else {
                document.body.style.backgroundColor = '#f5f5f5';
            }
        }

        button1.addEventListener('click', () => {
            locked = !locked;
            updateButtons();
        });

        button2.addEventListener('click', () => {
            subnet = !subnet;
            updateButtons();
        });

        button3.addEventListener('click', () => {
            ips = !ips;
            updateButtons();
        });

        button4.addEventListener('click', () => {
            showInfo = !showInfo;
            updateButtons();
        });

        button5.addEventListener('click', () => {
            hideLegend = !hideLegend;
            updateButtons();
        });

        button6.addEventListener('click', () => {
            tooltips = !tooltips;
            updateButtons();
        });

        button7.addEventListener('click', () => {
            darkMode = !darkMode;
            updateButtons();
        });

        function toggleNewWindow() {
            if (isOpen) {
                iframe.style.display = "none";
                consoleHost.style.backgroundColor = "#c1d72e";
                isOpen = false;
            } else {
                iframe.src = document.getElementById("console_host_link").url;
                iframe.style.display = "block";
                iframe.focus();
                consoleHost.style.backgroundColor = "#dc582a";
                isOpen = true;
            }
        }
        
        function toggleInterface() {
            if (generator) {
                interface1.style.display = "flex";
                interface2.style.display = "none";
                generator_button.style.backgroundColor = "#c1d72e";
                generator = false;
            } else {
                interface1.style.display = "none";
                interface2.style.display = "flex";
                generator_button.style.backgroundColor = "#dc582a";
                generator = true
            }
        }
    </script>
</body>

</html>